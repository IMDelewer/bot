#!/bin/bash

set -e

# === Config ===
INSTALL_DIR="/usr/local/bin/bot"
SERVICE_FILE="/etc/systemd/system/bot.service"
VENV_DIR="$INSTALL_DIR/venv"
MAIN_PY="$INSTALL_DIR/main.py"
REQS_TXT="$INSTALL_DIR/requirements.txt"

# === Colors ===
GREEN='\033[1;32m'
RED='\033[1;31m'
NC='\033[0m'

log() { echo -e "${GREEN}[INFO]${NC} $1"; }
error() { echo -e "${RED}[ERROR]${NC} $1"; }

# === 1. Stop the systemd service ===
log "Stopping the bot service..."
systemctl stop bot.service || { error "Failed to stop bot service"; exit 1; }

log "Disabling the bot service..."
systemctl disable bot.service || { error "Failed to disable bot service"; exit 1; }

# === 2. Remove systemd service file ===
log "Removing systemd service file..."
rm -f "$SERVICE_FILE" || { error "Failed to remove systemd service"; exit 1; }

# === 3. Remove the bot installation directory ===
log "Removing bot installation directory $INSTALL_DIR..."
rm -rf "$INSTALL_DIR" || { error "Failed to remove bot installation directory"; exit 1; }

# === 4. Reload systemd to apply changes ===
log "Reloading systemd to apply changes..."
systemctl daemon-reexec
systemctl daemon-reload

log "Bot and its service have been successfully removed!"
